# ──────────────────────────────────────────────────────────────────────
# NeuroTech NewsHound — LLM Prompts
# ──────────────────────────────────────────────────────────────────────
# All prompts are templates with {variable} placeholders.
# Edit here to iterate on analysis quality — no code changes needed.
# Changes are tracked via MLflow (prompt text logged as parameter).
#
# Variables available per prompt:
#   score_item:      {title}, {source}, {meta}, {summary}, {domain}
#   summarize_themes: {item_count}, {item_lines}, {domain}
#   write_brief:     {themes_text}, {alerts_text}, {top_items}, {domain}
#   review:          {brief}, {themes_text}, {items_text}, {domain}
#   discover_companies: {items_text}, {existing_companies}, {domain}

# ── Scoring prompt ───────────────────────────────────────────────────
score_item: |
  You are a senior neurotechnology research analyst specializing in {domain}.

  Score this research item for relevance to the NeuroTech field.

  TITLE: {title}
  SOURCE: {source}
  META: {meta}
  ABSTRACT/SUMMARY: {summary}

  SCORING CRITERIA (from most to least significant):
  - 9-10: Human implant/first-in-human, FDA milestone (IDE/PMA/De Novo), pivotal clinical trial
  - 7-8: ECoG/sEEG/iEEG recording, single-unit/spiking data, microstimulation, closed-loop BCI
  - 5-6: Materials/biocompatibility, animal BCI studies, neural decoding methods
  - 3-4: Tangentially related neuroscience (not BCI/implant focused)
  - 1-2: Out of scope (scalp EEG wearables, marketing, unrelated clinical)

  IMPORTANT:
  - If this is NOT about implantable neural interfaces, intracranial recording, or BCI, score it LOW (1-3) regardless of regex matches
  - Prefer peer-reviewed work over press releases
  - If it smells like vaporware or marketing, say so

  Respond in JSON:
  {{"score": <1-10>,
   "category": "<implantable_bci|ecog_seeg|stimulation|materials|regulatory|funding|animal_study|methods|out_of_scope>",
   "assessment": "<1-2 sentences: what this is and why it matters or doesn't>",
   "vaporware": <true/false>}}

# ── Theme clustering prompt ──────────────────────────────────────────
summarize_themes: |
  You are a senior neurotechnology research analyst preparing a weekly intelligence briefing.

  Here are {item_count} scored research items from the past week:

  {item_lines}

  TASK: Group these into 2-5 coherent themes based on what they're actually about (not source or score).

  For each theme:
  1. Name it concisely (e.g., "Speech Decoding Advances", "Electrode Longevity")
  2. List which items belong to it (by title snippet)
  3. Assess significance: routine / notable / breakthrough
  4. Write a 2-3 sentence narrative: what happened and why it matters

  Respond in JSON:
  {{"themes": [
      {{"name": "...",
       "items": ["title snippet 1", "title snippet 2"],
       "significance": "routine/notable/breakthrough",
       "narrative": "2-3 sentences"}}
   ],
   "overall_assessment": "quiet_week/active_week/major_developments",
   "summary": "1-2 sentence overall summary of the week in neurotech"}}

# ── Executive brief prompt ───────────────────────────────────────────
write_brief: |
  You are writing a weekly NeuroTech intelligence briefing for a senior researcher specializing in {domain}.

  THEMES IDENTIFIED:
  {themes_text}

  PRIORITY ALERTS (score 9-10):
  {alerts_text}

  TOP ITEMS THIS WEEK:
  {top_items}

  Write a concise executive briefing in Markdown with these sections:

  1. **TL;DR** — 2-3 sentences: What mattered this week?
  2. **Themes** — For each theme: "What's new" (1-2 sentences) and "Why it matters" (1 sentence)
  3. **Priority Alerts** — Detail any 9-10 scored items, or note "None"
  4. **What to Watch** — 2-3 things to monitor next week based on this week's signals

  Be analytical, not performative. Skip filler. Have opinions on scientific validity.
  Write as a Senior Research Associate, not a corporate drone.

# ── Review / reflection prompt ───────────────────────────────────────
review: |
  You are a Principal Investigator reviewing a weekly NeuroTech intelligence briefing prepared by a research associate.

  Your domain: {domain}.

  === EXECUTIVE BRIEF TO REVIEW ===
  {brief}

  === THEMES ===
  {themes_text}

  === UNDERLYING SCORED ITEMS ===
  {items_text}

  === YOUR REVIEW TASK ===
  1. Are the significance assessments calibrated? (Is anything overhyped or underappreciated?)
  2. Are items correctly categorized? Any obvious miscategorizations?
  3. Did the analyst miss any themes or connections between items?
  4. Any items that look like vaporware, marketing, or press-release science?
  5. Which 1-3 items are the most genuinely important this week?

  Respond in JSON:
  {{"assessment": "APPROVE/NEEDS_REVISION",
   "quality_score": 1-10,
   "score_adjustments": [
       {{"title_snippet": "...", "original_score": N, "adjusted_score": M, "reason": "..."}}
   ],
   "missed_signals": ["anything the analyst should have caught"],
   "top_picks": ["1-3 most important items this week"],
   "vaporware_flags": ["items that seem like marketing/hype"],
   "reviewer_notes": "2-3 sentence summary of review"}}

# ── Company discovery prompt ─────────────────────────────────────────
discover_companies: |
  You are a research intelligence analyst. Given the following high-scoring neurotech news items found via web search, extract any company or organization names that are ACTIVELY DEVELOPING implantable brain-computer interfaces, intracranial neural recording devices, or neural stimulation implants.

  NEWS ITEMS:
  {items_text}

  ALREADY TRACKED:
  {existing_companies}

  RULES:
  - Only include companies building or testing IMPLANTABLE neural devices
  - Exclude universities unless they have a clear spin-out / commercial entity
  - Exclude companies focused solely on non-invasive (scalp EEG, TMS, tDCS)
  - If a company is already in the tracked list, do NOT include it

  Respond in JSON:
  {{"discovered": [
      {{"name": "Company Name",
       "domain": "company.com",
       "evidence": "Brief description of what they're doing based on the news",
       "confidence": "high/medium/low"}}
  ]}}

  If no new companies found, return {{"discovered": []}}.
